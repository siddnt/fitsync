<%- include('../partials/header') %>

<main>
  <div class="container my-5">
    <div class="row">
      <div class="col-lg-8 mx-auto">
        <div class="card">
          <div class="card-header bg-danger text-white text-center">
            <h2><i class="fas fa-calendar-check me-2"></i>Book <%= plan.title %> Session</h2>
          </div>
          <div class="card-body">
            <div class="row mb-4">
              <div class="col-md-5">
                <img src="<%= plan.image %>" alt="<%= plan.title %>" class="img-fluid rounded" style="max-height: 250px; width: 100%; object-fit: cover;">
              </div>
              <div class="col-md-7">
                <h4 class="card-title"><%= plan.title %></h4>
                <p class="text-muted"><%= plan.description %></p>
                <div class="d-flex justify-content-between mt-2">
                  <div>
                    <small class="text-muted d-block"><i class="fas fa-clock me-1"></i><%= plan.features.duration %></small>
                    <small class="text-muted d-block"><i class="fas fa-calendar-alt me-1"></i><%= plan.features.sessions %> sessions per week</small>
                  </div>
                  <div>
                    <h5 class="text-danger"><%= plan.features.price %></h5>
                  </div>
                </div>
              </div>
            </div>

            <form action="/bookings/plan/<%= plan.id %>" method="POST">
              <input type="hidden" name="planId" value="<%= plan.id %>">
              <div class="mb-3">
                <label for="trainer" class="form-label"><i class="fas fa-user-tie me-2"></i>Select Trainer</label>
                <select class="form-select" id="trainer" name="trainerId" required>
                  <option value="" selected disabled>Choose a trainer...</option>
                  <% if (trainers && trainers.length > 0) { %>
                    <% trainers.forEach(trainer => { %>
                      <option value="<%= trainer._id %>"><%= trainer.name %> <%= trainer.specializations ? `(${trainer.specializations.join(', ')})` : '' %></option>
                    <% }); %>
                  <% } else { %>
                    <option disabled>No trainers available</option>
                  <% } %>
                </select>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="startDate" class="form-label"><i class="fas fa-calendar me-2"></i>Date</label>
                  <input type="date" class="form-control" id="startDate" name="startDate" required 
                         min="<%= new Date().toISOString().split('T')[0] %>">
                </div>
                
                <div class="col-md-6 mb-3">
                  <label for="startTime" class="form-label"><i class="fas fa-clock me-2"></i>Time</label>
                  <select class="form-select" id="startTime" name="startTime" required>
                    <option value="" selected disabled>Select a time...</option>
                    <option value="09:00">9:00 AM</option>
                    <option value="10:00">10:00 AM</option>
                    <option value="11:00">11:00 AM</option>
                    <option value="12:00">12:00 PM</option>
                    <option value="13:00">1:00 PM</option>
                    <option value="14:00">2:00 PM</option>
                    <option value="15:00">3:00 PM</option>
                    <option value="16:00">4:00 PM</option>
                    <option value="17:00">5:00 PM</option>
                    <option value="18:00">6:00 PM</option>
                    <option value="19:00">7:00 PM</option>
                  </select>
                </div>
              </div>

              <div class="mb-3">
                <label for="notes" class="form-label"><i class="fas fa-sticky-note me-2"></i>Additional Notes (Optional)</label>
                <textarea class="form-control" id="notes" name="notes" rows="3" placeholder="Any specific requirements or questions for the trainer..."></textarea>
              </div>

              <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Booking Policy:</strong> Cancellations must be made at least 24 hours before the scheduled session. Late cancellations may incur a fee.
              </div>

              <div class="d-grid gap-2 mt-4">
                <button type="submit" class="btn btn-danger btn-lg">
                  <i class="fas fa-check-circle me-2"></i>Book Now
                </button>
                <a href="/plans" class="btn btn-outline-secondary">
                  <i class="fas fa-arrow-left me-2"></i>Back to Plans
                </a>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<script>
  // Disable past dates in datepicker
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('startDate').setAttribute('min', today);
  
  // Validate form before submission
  document.querySelector('form').addEventListener('submit', function(e) {
    const trainer = document.getElementById('trainer').value;
    const date = document.getElementById('startDate').value;
    const time = document.getElementById('startTime').value;
    
    if (!trainer || !date || !time) {
      e.preventDefault();
      alert('Please fill in all required fields.');
    }
  });
</script>

<%- include('../partials/footer') %>